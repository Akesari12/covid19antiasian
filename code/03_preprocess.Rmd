---
title: "03_preprocess_data"
author: "Jae Yeon Kim"
date: "7/2/2020"
output: html_document
---

# Import packages and files 

## Packages

```{r}

pacman::p_load(tidyverse, # for tidyverse 
               here, # for reproducibility 
               countrycode, # to convert country code <-> country name 
               stringr, # for easy regular expression
               lubridate) # for easy time var manipulation
```

## Files 

```{r}

parsed <- readRDS(file.choose())

```

## Wrangle 

### Select and Filter 

```{r}

# Select columns 
selected <- parsed %>% 
    select(country_code, created_at, full_text) %>%
    filter(!is.na(country_code))

# Remove cases where country code is ""
selected <- selected %>%
    filter(!(country_code == ""))
```

### Mutate 

```{r}

# Lower case 
selected$full_text <- str_to_lower(selected$full_text)

# Create new columns 
selected <- selected %>%
    mutate(full_text = str_to_lower(full_text),
           wuhan = as.numeric(str_detect(full_text, "wuhan")),
           asian = as.numeric(str_detect(full_text, "asia|asian")),
           chinese = as.numeric(str_detect(full_text, "china|chinese")),
           US = ifelse(country_code == "US", 1, 0),
           country_name = countrycode(country_code, "iso2c", "country.name")
    )

selected$date <- as.POSIXct(selected$created_at, 
                            tz = "UTC",
                            format = "%a %b %d %H:%M:%S %z %Y") %>% # Reformat date-time 
                 word(1) # Only year month date 
    
# Remove except selected
rm(list = setdiff(ls(), "selected"))

```

## Explore 


```{r}

selected %>% 
    group_by(country_name) %>%
    count(sort = TRUE)

```


